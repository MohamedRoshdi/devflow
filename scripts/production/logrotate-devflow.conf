# DevFlow Pro Log Rotation Configuration
# Place this file in /etc/logrotate.d/devflow

# Laravel application logs
/var/www/devflow-pro/storage/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    su www-data www-data
    sharedscripts
    postrotate
        # Optional: restart PHP-FPM if needed
        # systemctl reload php8.3-fpm > /dev/null 2>&1 || true
    endscript
}

# ATS Pro application logs
/var/www/ats-pro/storage/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    su www-data www-data
    sharedscripts
}

# Backup logs
/opt/backups/databases/*.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 0644 root root
}

# Monitoring logs
/var/log/devflow-monitor.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0644 root root
    size 10M
}

# Nginx logs (if not already configured)
/var/log/nginx/devflow-*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}

# MySQL logs
/var/log/mysql/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 mysql mysql
    sharedscripts
    postrotate
        test -x /usr/bin/mysqladmin && \
        mysqladmin --defaults-file=/etc/mysql/debian.cnf ping &>/dev/null || true
    endscript
}
