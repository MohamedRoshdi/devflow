# Redis Performance Optimization Configuration
# Add these settings to redis.conf or use in docker-compose environment

# Memory Management
maxmemory 512mb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# Persistence Settings (for sessions/cache, disable persistence for better performance)
# For cache-only (no persistence):
save ""
appendonly no

# For persistence (sessions/important data):
# save 900 1
# save 300 10
# save 60 10000
# appendonly yes
# appendfsync everysec

# Networking
tcp-backlog 511
timeout 300
tcp-keepalive 60

# Performance Tuning
databases 16
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes

# Slow Log
slowlog-log-slower-than 10000  # microseconds (10ms)
slowlog-max-len 128

# Connection Limits
maxclients 10000

# Thread IO (Redis 6.0+)
io-threads 4
io-threads-do-reads yes

# Memory Optimization
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Kernel Optimizations (add to /etc/sysctl.conf)
# vm.overcommit_memory = 1
# net.core.somaxconn = 65535

# Disable Transparent Huge Pages (THP)
# echo never > /sys/kernel/mm/transparent_hugepage/enabled
# Add to /etc/rc.local for persistence
