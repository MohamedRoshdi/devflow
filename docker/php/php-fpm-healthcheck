#!/bin/sh
# PHP-FPM Health Check Script
# Checks if PHP-FPM is responding to requests

set -e

# Check if PHP-FPM is running
if ! pgrep -x php-fpm > /dev/null; then
    echo "PHP-FPM is not running"
    exit 1
fi

# Try to connect to PHP-FPM socket/port
if ! nc -z 127.0.0.1 9000 2>/dev/null; then
    echo "PHP-FPM is not accepting connections on port 9000"
    exit 1
fi

# Optional: Check PHP-FPM status page if configured
# SCRIPT_NAME=/ping SCRIPT_FILENAME=/ping REQUEST_METHOD=GET cgi-fcgi -bind -connect 127.0.0.1:9000

echo "PHP-FPM is healthy"
exit 0
